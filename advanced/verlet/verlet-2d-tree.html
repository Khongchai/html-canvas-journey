<!-- Steps -->
<!-- Draw tree segment DONE -->
<!-- Draw tree handle (the circle points) DONE -->
<!-- Make each of the node repel one another -->
<!-- Drag and follow mouse -->
<!-- Constraint each point based on the stick -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title></title>
    <style>
      html,
      body {
        border: 0;
        padding: 0;
        margin: 0;
      }
    </style>
  </head>
  <body onload="draw();">
    <div><canvas id="canvas"></canvas></div>
  </body>
  <script>
    class Point {
      constructor(x, y) {
        this.x = x;
        this.y = y;
        this.radius = 10;
      }
    }
  </script>
  <script>
    let canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    var width = window.innerWidth;
    var height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;

    const treeSegments = {
      segments: [],
      getPoints: function () {
        let points = [];

        // Get the first point at the bottom
        points.push(new Point(this.segments[0].p0.x, this.segments[0].p0.y));

        for (let i = 0; i < this.segments.length; i++) {
          points.push(new Point(this.segments[i].p1.x, this.segments[i].p1.y));
        }
        return points;
      },
    };
  </script>
  <script>
    window.addEventListener("mousedown", (e) => {
      treeSegments.forEach((segment) => {
        if (segment == e.target) {
          segment.style.backgroundColor = "red";
        }
      });
    });
  </script>
  <script>
    function getTreeSegments(x1, y1, beginningAngle, depth, arrayToAddTo) {
      const branchSplitRadian = 0.349066; // About 20 degrees
      const scale = 30;

      if (depth !== 0) {
        const x2 = x1 + Math.cos(beginningAngle) * depth * scale;
        const y2 = y1 + Math.sin(beginningAngle) * depth * scale;
        arrayToAddTo.push({
          p0: {
            x: x1,
            y: y1,
          },
          p1: {
            x: x2,
            y: y2,
          },
          length: Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2)),
        });
        getTreeSegments(
          x2,
          y2,
          beginningAngle - branchSplitRadian,
          depth - 1,
          arrayToAddTo
        );
        getTreeSegments(
          x2,
          y2,
          beginningAngle + branchSplitRadian,
          depth - 1,
          arrayToAddTo
        );
      }
    }

    function drawPoints(treeSegments) {
      treeSegments.getPoints().forEach((point) => {
        ctx.beginPath();
        ctx.arc(point.x, point.y, point.radius, 0, 2 * Math.PI);
        ctx.fill();
      });
    }

    function drawSegments(treeSegments) {
      treeSegments.segments.forEach((segment) => {
        ctx.beginPath();
        ctx.moveTo(segment.p0.x, segment.p0.y);
        ctx.lineTo(segment.p1.x, segment.p1.y);
        ctx.stroke();
      });
    }

    function updatePointsBasedOnUserInteraction(points) {}
  </script>
  <script>
    getTreeSegments(
      width / 2,
      height / 1.5,
      -Math.PI / 2,
      5,
      treeSegments.segments
    );

    const draw = () => {
      ctx.clearRect(0, 0, canvas.clientWidth, canvas.clientHeight);

      updatePointsBasedOnUserInteraction();
      drawSegments(treeSegments);
      drawPoints(treeSegments);

      requestAnimationFrame(draw);
    };
  </script>
</html>
